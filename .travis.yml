language: php

# This should make the builds faster
sudo: false

php:
  # aws-sdk-php needs php >+ 5.5
  - 5.5
  - 5.6
  - 7.0
  - hhvm

env:
  # Test only on versions of Sf that are still supported
  - SYMFONY_VERSION=2.4.*
  - SYMFONY_VERSION=2.6.*
  - SYMFONY_VERSION=2.7.*

matrix:
  allow_failures:
    # at the moment it gives an error with Sf 2.6 and 2.7...
    - php: 7.0
  # encrypte env vars to use for Symnfony config
  secure: "DOtXyW45LmbBaygQ2OyfSCfnrYtBjzTsfj7JS1OYP/mYARJxFVEARE6FKJADXD+kFnzHFy8Kq+4layAPVggI5pLCdsLS5UHnArliDbFRy7W4cPffBRL8HJc8Ay9d0YSv1YVD4d3zxsnmS3/80Zt6/MD23QfDpzclka5M+5YpMRkV73/YHKAgW7Keh9glzvZXr5ns5fFyDFW38ulOERH4EhQcTLLZBICgQZGaOhanIFyBoq9YyeUFI7GOHxS+sqfFvbT9TnnsaWTHnyMdtRvKoH3aiN0Dk6mVFrZWGTDAVkGPGz50iYT3Dwwker0Dh71x73NmnBA/Z1pnWrTW96BTnzi3GaTpcfraGuOHmGDsu4cWz41u3+66jFvypwYobjPBJCHB5vF5HmbCrXC1JrInEsitnbsU0fO37/QWqZzqAY7jX+2IXU93z/5K7TnqUdKyTeJPkHFi9l66vA8M3zPgVGzqq33AQ6GKy1XAgk0n29Mykxj0sgwKVdoq4BCtsYuIetnTUFgE4Z/w5zeUtpE7eIGEU9WUdoz5bhYoHME6p3eXF72KFkgOw+wK+MxZEzHUMMfdtRnDgx+xu2VHlfJezf+KH6awyy4="

before_install:
  # This is mandatory or 'apt-get install' calls following will fail
  #- sudo apt-get update -qq

install:
  - composer self-update
  - composer require --prefer-source --dev symfony/symfony:${SYMFONY_VERSION}
  - composer install

before_script:
  - cp phpunit.xml.dist phpunit.xml

script:
  phpunit --coverage-clover=coverage.clover Tests/phpunit

after_failure:
  # Display as much info as we can to help developers
  #- cat apache_error.log
  #- cat apache_access.log
  #- cat /var/log/hhvm/error.log
  #- if [ "$TRAVIS_PHP_VERSION" = "hhvm" ]; then php -i; fi

after_script:
  # Upload code-coverage to Scrutinizer
  - if [ "$TRAVIS_PHP_VERSION" = "5.6" ]; then wget https://scrutinizer-ci.com/ocular.phar; fi
  - if [ "$TRAVIS_PHP_VERSION" = "5.6" ]; then php ocular.phar code-coverage:upload --format=php-clover coverage.clover; fi
  # Upload code-coverage CodeClimate
  - if [ "$TRAVIS_PHP_VERSION" = "5.6" ]; then CODECLIMATE_REPO_TOKEN=TOBEGOTTEN ./vendor/bin/test-reporter --coverage-report=coverage.clover; fi

cache:
  directories:
    - $COMPOSER_CACHE_DIR
